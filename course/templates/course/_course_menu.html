{% load i18n %}
{% load course %}
{% load exercise %}
{% load notification %}
{% load external_services %}
{% load static %}

{% prepare_course_menu %}

{% get_current_language as LANGUAGE_CODE %}

<li>
	<a href="#course-content" class="skip-link page-skip-link d-none d-sm-block">
		<span class="">{% translate "SKIP_COURSE_NAVIGATION" %}</span>
	</a>
</li>
<div class="d-flex justify-content-between align-baseline">
	<h4 class="course-menu-label" id="course-menu-heading">{% translate "COURSE" %}</h4>
	<div class="course-sidebar-button d-none d-md-block">
		<button
			class="aplus-button--secondary course-sidebar-collapser d-flex align-items-center justify-content-center"
			title="{% translate "MINIMISE_SIDEBAR" %}"
			aria-label="{% translate "MINIMISE_SIDEBAR" %}"
		>
			<i class="bi-layout-sidebar" aria-hidden="true"></i>
		</button>
	</div>
</div>

{% if instance.language|first == "|" %}
<div class="sidebar-lang-menu d-block dropdown mb-2">
	<button class="aplus-button--secondary aplus-button--sm" id="sidebar-lang-dropdown" type="button"
		data-bs-toggle="dropdown" title="{% translate "CHANGE_LANGUAGE" %}"
		aria-label="{% translate "CHANGE_LANGUAGE" %}" aria-haspopup="true" aria-expanded="false"
	>
		<i class="bi bi-translate" alt="" data-bs-toggle="tooltip"
			data-bs-placement="right"
			title="{% translate "CHANGE_LANGUAGE" %}">
		</i>
		<span id="sidebar-lang-dropdown-label">{% translate "LANGUAGE" %}</span>
	</button>
	<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="sidebar-lang-dropdown" style="min-width: 8rem;">
		{% for language in instance.language|list_languages %}
		<li class="dropdown-item p-0">
			<form action="{{ instance|url:'set-enrollment-language' }}" method="post">
				{% csrf_token %}
				<input name="next" type="hidden" value="{{ request.get_full_path }}" />
				<input name="language" type="hidden" value="{{ language }}" />
				<button type="submit" {% if LANGUAGE_CODE == language %}aria-current="true"{% endif %}>
					{{ language|language_name_local }} {% if LANGUAGE_CODE == language %}<span class="bi bi-check"></span>{% endif %}
				</button>
			</form>
		</li>
		{% endfor %}
	</ul>
</div>
{% endif %}

<li class="nav-item">
	<a class="nav-link menu-home" href="{{ instance|url }}">
		<i class="bi-house-door-fill" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="right" title="{{ course.code }}"></i>
		<span class="course-menu-label">{{ course.code }}</span>
	</a>
</li>
<li class="nav-item">
	<a class="nav-link menu-toc" href="{{ instance|url:'toc' }}">
		<i class="bi-book" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="right" title="{% translate "COURSE_MATERIALS" %}"></i>
		<span class="course-menu-label">{% translate "COURSE_MATERIALS" %}</span>
	</a>
</li>
<li class="nav-item">
	<a class="nav-link menu-results" href="{{ instance|url:'results' }}">
		<i class="bi-bar-chart-fill" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="right" title="{% translate "EXERCISE_RESULTS" %}"></i>
		<span class="course-menu-label">{% translate "EXERCISE_RESULTS" %}</span>
	</a>
</li>

{% if instance.group_work_allowed %}
<li class="nav-item">
	<a class="nav-link menu-groups" href="{{ instance|url:'groups' }}">
		<i class="bi-heart-fill" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="right" title="{% translate "FORM_A_GROUP" %}"></i>
		<span class="course-menu-label">{% translate "FORM_A_GROUP" %}</span>
	</a>
</li>
{% endif %}

{% for group in course_menu.student_link_groups %}
{% if group.label == '' %}
{% for entry in group.items %}
{% if entry.enabled %}
<li class="nav-item">
	{% is_external_menu_url entry.url as is_external_menu_url_flag %}
	<a class="nav-link d-flex align-items-center gap-1" href="{{ entry.url }}" {% if is_external_menu_url_flag or entry.blank %} target="_blank" {% endif %}>
		{% if entry.icon_class %}
		<i class="bi-{{ entry.icon_class }}" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="right" title="{{ entry.label|parse_localization }}"></i>
		{% else %}
		<i class="bi-pin-angle-fill" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="right" title="{{ entry.label|parse_localization }}"></i>
		{% endif %}
		<span class="course-menu-label">{{ entry.label|parse_localization }}</span>
	</a>
</li>
{% endif %}
{% endfor %}
{% endif %}
{% endfor %}

{% for group in course_menu.student_link_groups %}
{% if group.label != '' %}
<li class="header">
	<h4 class="course-menu-label">{{ group.label|parse_localization }}</h4>
</li>
{% for entry in group.items %}
{% if entry.enabled %}
<li class="nav-item">
	{% is_external_menu_url entry.url as is_external_menu_url_flag %}
	<a class="nav-link d-flex align-items-center gap-1" href="{{ entry.url }}" {% if is_external_menu_url_flag or entry.blank %} target="_blank" {% endif %}>
		{% if entry.icon_class %}
		<span class="bi-{{ entry.icon_class }}" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="right" title="{{ entry.label|parse_localization }}"></span>
		{% else %}
		<span class="bi-pin-angle-fill" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="right" title="{{ entry.label|parse_localization }}"></span>
		{% endif %}
		<span class="course-menu-label">{{ entry.label|parse_localization }}</span>
	</a>
</li>
{% endif %}
{% endfor %}
{% endif %}
{% endfor %}

{% for tab in instance.tabs.all %}
{% if forloop.first %}
<li class="header">
	<h4 class="course-menu-label">{% translate "APPS" %}</h4>
</li>
{% endif %}
<li class="menu-tab{{ tab.id }}">
	<a href="{% url 'apps-tab' course_slug=course.url instance_slug=instance.url tab_id=tab.id %}">
		<i class="bi-th-large" aria-hidden="true"></i>
		{{ tab.label }}
	</a>
</li>
{% endfor %}

{% if is_course_staff %}
<li class="header">
	<h4 class="course-menu-label">{% translate "COURSE_STAFF" %}</h4>
</li>

<li class="nav-item">
	<a class="nav-link menu-participants" href="{{ instance|url:'participants' }}">
		<i class="bi-list-ul" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="right" title="{% translate "PARTICIPANTS" %}"></i>
		<span class="course-menu-label">{% translate "PARTICIPANTS" %}</span>
	</a>
</li>

<li class="nav-item">
	<a class="nav-link menu-groups-edit" href="{{ instance|url:'groups-list' }}">
		<i class="bi-list-ul" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="right" title="{% translate "GROUPS" %}"></i>
		<span class="course-menu-label">{% translate "GROUPS" %}</span>
	</a>
</li>

{% if instance.coursediplomadesign %}
<li class="nav-item">
	<a class="nav-link menu-grades" href="{% url 'diploma-list' instance.coursediplomadesign.id %}">
		<i class="bi-certificate" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="right" title="{% translate "GRADES" %}"></i>
		<span class="course-menu-label">{% translate "GRADES" %}</span>
	</a>
</li>
{% endif %}
{% endif %}

{% if is_teacher %}
<li class="nav-item">
	<a class="nav-link menu-all-results" href="{{ instance|url:'all-results' }}">
		<i class="bi-folder2-open" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="right" title="{% translate "ALL_RESULTS" %}"></i>
		<span class="course-menu-label">{% translate "ALL_RESULTS" %}</span>
	</a>
</li>

<li class="nav-item">
	<a class="nav-link menu-analytics" href="{{ instance|url:'analytics' }}">
		<i class="bi-bar-chart-fill" aria-hidden="true"  data-bs-toggle="tooltip" data-bs-placement="right" title="{% translate "VISUALIZATIONS" %}"></i>
		<span class="course-menu-label">{% translate "VISUALIZATIONS" %}</span>
	</a>
</li>
{% endif %}

{% if is_course_staff %}
<li class="nav-item">
	<a class="nav-link menu-pseudonymize" href="{% url 'toggle-pseudonymization' %}">
		{% if pseudonymize %}
			<i class="bi-eye-fill" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="right" title="{% translate "UNPSEUDONYMIZE" %}"></i>
			<span class="course-menu-label">{% translate "UNPSEUDONYMIZE" %}</span>
		{% else %}
			<i class="bi-eye-slash-fill" aria-hidden="true"  data-bs-toggle="tooltip" data-bs-placement="right" title="{% translate "PSEUDONYMIZE" %}"></i>
			<span class="course-menu-label">{% translate "PSEUDONYMIZE" %}</span>
		{% endif %}
	</a>
</li>
{% endif %}

{% if is_teacher %}
<li class="nav-item">
	<a class="nav-link menu-edit-news" href="{{ instance|url:'news-list' }}">
		<i class="bi-pencil-square" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="right" title="{% translate "EDIT_NEWS" %}"></i>
		<span class="course-menu-label">{% translate "EDIT_NEWS" %}</span>
	</a>
</li>
<li class="nav-item menu-edit-course">
	<a class="nav-link menu-course" href="{{ instance|url:'course-edit' }}">
		<i class="bi-gear-fill" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="right" title="{% translate "EDIT_COURSE" %}"></i>
		<span class="course-menu-label">{% translate "EDIT_COURSE" %}</span>
	</a>
</li>
<li class="nav-item">
	<a class="nav-link menu-deadline-deviations" href="{{ instance|url:'deviations-list-dl' }}">
		<i class="bi-list-ul" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="right" title="{% translate "DEADLINE_DEVIATIONS" %}"></i>
		<span class="course-menu-label">{% translate "DEADLINE_DEVIATIONS" %}</span>
	</a>
</li>
<li class="nav-item">
	<a class="nav-link menu-submission-deviations" href="{{ instance|url:'deviations-list-submissions' }}">
		<i class="bi-list-ul" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="right" title="{% translate "SUBMISSION_DEVIATIONS" %}"></i>
		<span class="course-menu-label">{% translate "SUBMISSION_DEVIATIONS" %}</span>
	</a>
</li>
<li class="nav-item">
	<a class="nav-link menu-all-submissions" href="{{ instance|url:'all-submissions' }}?limited=true">
		<span class="bi-list-ul" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="right" title="{% translate "ALL_SUBMISSIONS" %}"></span>
		<span class="course-menu-label">{% translate "ALL_SUBMISSIONS" %}</span>
	</a>
</li>
{% endif %}

{% for group in course_menu.staff_link_groups %}
{% if group.label %}
<li class="header">
	<h4 class="course-menu-label">{{ group.label|parse_localization }}</h4>
</li>
{% endif %}
{% for entry in group.items %}
{% if entry.enabled %}
{% if is_teacher or entry|is_assistant_link %}
<li class="nav-item">
	<a class="nav-link d-flex align-items-center gap-1" href="{{ entry.url }}" {% if entry.blank %} target="_blank" {% endif %}>
		{% if entry.icon_class %}
		<i class="bi-{{ entry.icon_class }}" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="right" title="{{ entry.label|parse_localization }}"></i>
		{% else %}
		<i class="bi-pin-angle-fill" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="right" title="{{ entry.label|parse_localization }}"></i>
		{% endif %}
		<span class="course-menu-label">{{ entry.label|parse_localization }}</span>
	</a>
</li>
{% endif %}
{% endif %}
{% endfor %}
{% endfor %}

{% comment %}
{% if is_student %}
<li class="header">
	<h4 class="course-menu-label">{% trans "ENROLLMENT" %}</h4>
</li>
<li class="menu-unenroll">
	<a data-bs-toggle="modal" data-bs-target="#unenroll-modal" role="button">
		<i class="bi-x-lg-sign" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="right" title="{% trans "UNENROLL" %}"></i>
		{% trans "UNENROLL" %}
	</a>
</li>
{% endif %}
{% endcomment %}
