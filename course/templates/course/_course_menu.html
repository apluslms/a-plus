{% load i18n %}
{% load course %}
{% load exercise %}
{% load notification %}
{% load external_services %}
{% load static %}

{% prepare_course_menu %}

{% get_current_language as LANGUAGE_CODE %}

<li>
	<a href="#course-content" class="skip-link page-skip-link d-none d-sm-block">
		{% translate "SKIP_COURSE_NAVIGATION" %}
	</a>
</li>

{% if instance.language|first == "|" %}
<li class="header d-block d-sm-none">
	<h4 id="course-menu-heading">{% translate "LANGUAGE" %}</h4>
</li>
<li class="d-block d-sm-none dropdown">
	<a href="#" class="dropdown-toggle" id="lang-dropdown-mobile" data-bs-toggle="dropdown" role="button"
		aria-haspopup="true" aria-expanded="false">
		{% translate "CHANGE_LANGUAGE" %} 
	</a>
	<ul class="dropdown-menu" aria-labelledby="lang-dropdown-mobile">
		{% for language in instance.language|list_languages %}
		<li role="none">
			<form action="{{ instance|url:'set-enrollment-language' }}" method="post">
				{% csrf_token %}
				<input name="next" type="hidden" value="{{ request.get_full_path }}" />
				<input name="language" type="hidden" value="{{ language }}" />
				<button type="submit" class="btn" {% if LANGUAGE_CODE == language %}aria-current="true"{% endif %}>
					{{ language|language_name_local }} {% if LANGUAGE_CODE == language %}<span class="gi-check"></span>{% endif %}
				</button>
			</form>
		</li>
		{% endfor %}
	</ul>
</li>
{% endif %}
<li class="header">
	{% if instance.language|first == "|" %}
	<div class="course-sidebar-button float-end d-none d-sm-block dropdown">
		<button class="aplus-button--secondary aplus-button--xs" id="lang-dropdown-desktop" type="button"
			data-bs-toggle="dropdown" title="{% translate "CHANGE_LANGUAGE" %}"
			aria-label="{% translate "CHANGE_LANGUAGE" %}" aria-haspopup="true" aria-expanded="false"
		>
			<img src="{% static 'images/uls.svg' %}" alt="">
			<span>Language</span>
		</button>
		<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="lang-dropdown-desktop">
			{% for language in instance.language|list_languages %}
			<li>
				<form action="{{ instance|url:'set-enrollment-language' }}" method="post">
					{% csrf_token %}
					<input name="next" type="hidden" value="{{ request.get_full_path }}" />
					<input name="language" type="hidden" value="{{ language }}" />
					<button type="submit" class="btn" {% if LANGUAGE_CODE == language %}aria-current="true"{% endif %}>
						{{ language|language_name_local }} {% if LANGUAGE_CODE == language %}<span class="gi-check"></span>{% endif %}
					</button>
				</form>
			</li>
			{% endfor %}
		</ul>
	</div>
	{% endif %}
	<div class="course-sidebar-button float-end d-none d-sm-block">
		<button
			class="aplus-button--secondary aplus-button--xs course-sidebar-collapser"
			title="{% translate "CLOSE_SIDEBAR" %}"
			aria-label="{% translate "CLOSE_SIDEBAR" %}"
		>
			<i class="bi-caret-left-fill" aria-hidden="true"></i>
		</button>
	</div>
	<h4 id="course-menu-heading">{% translate "COURSE" %}</h4>
</li>

<li class="nav-item">
	<a class="nav-link menu-home" href="{{ instance|url }}">
		<i class="bi-house-door-fill" aria-hidden="true"></i>
		{{ course.code }}
	</a>
</li>
<li class="nav-item">
	<a class="nav-link menu-toc" href="{{ instance|url:'toc' }}">
		<i class="bi-book" aria-hidden="true"></i>
		{% translate "COURSE_MATERIALS" %}
	</a>
</li>
<li class="nav-item">
	<a class="nav-link menu-results" href="{{ instance|url:'results' }}">
		<i class="bi-bar-chart-fill" aria-hidden="true"></i>
		{% translate "EXERCISE_RESULTS" %}
	</a>
</li>

{% if instance.group_work_allowed %}
<li class="nav-item">
	<a class="nav-link menu-groups" href="{{ instance|url:'groups' }}">
		<i class="bi-heart-fill" aria-hidden="true"></i>
		{% translate "FORM_A_GROUP" %}
	</a>
</li>
{% endif %}

{% for group in course_menu.student_link_groups %}
{% if group.label == '' %}
{% for entry in group.items %}
{% if entry.enabled %}
<li>
	{% is_external_menu_url entry.url as is_external_menu_url_flag %}
	<a href="{{ entry.url }}" {% if is_external_menu_url_flag or entry.blank %} target="_blank" {% endif %}>
		{% if entry.icon_class %}
		<i class="bi-{{ entry.icon_class }}" aria-hidden="true"></i>
		{% endif %}
		{{ entry.label|parse_localization }}
	</a>
</li>
{% endif %}
{% endfor %}
{% endif %}
{% endfor %}

{% for group in course_menu.student_link_groups %}
{% if group.label != '' %}
<li class="header">
	<h4>{{ group.label|parse_localization }}</h4>
</li>
{% for entry in group.items %}
{% if entry.enabled %}
<li>
	{% is_external_menu_url entry.url as is_external_menu_url_flag %}
	<a href="{{ entry.url }}" {% if is_external_menu_url_flag or entry.blank %} target="_blank" {% endif %}>
		{% if entry.icon_class %}
		<span class="gi-{{ entry.icon_class }}" aria-hidden="true"></span>
		{% endif %}
		{{ entry.label|parse_localization }}
	</a>
</li>
{% endif %}
{% endfor %}
{% endif %}
{% endfor %}

{% for tab in instance.tabs.all %}
{% if forloop.first %}
<li class="header">
	<h4>{% translate "APPS" %}</h4>
</li>
{% endif %}
<li class="menu-tab{{ tab.id }}">
	<a href="{% url 'apps-tab' course_slug=course.url instance_slug=instance.url tab_id=tab.id %}">
		<i class="bi-th-large" aria-hidden="true"></i>
		{{ tab.label }}
	</a>
</li>
{% endfor %}

{% if is_course_staff %}
<li class="header">
	<h4>{% translate "COURSE_STAFF" %}</h4>
</li>

<li class="nav-item">
	<a class="nav-link menu-participants" href="{{ instance|url:'participants' }}">
		<i class="bi-list" aria-hidden="true"></i>
		{% translate "PARTICIPANTS" %}
	</a>
</li>

<li class="nav-item">
	<a class="nav-link menu-groups-edit" href="{{ instance|url:'groups-list' }}">
		<i class="bi-list" aria-hidden="true"></i>
		{% translate "GROUPS" %}
	</a>
</li>

{% if instance.coursediplomadesign %}
<li class="nav-item">
	<a class="nav-link menu-grades" href="{% url 'diploma-list' instance.coursediplomadesign.id %}">
		<i class="bi-certificate" aria-hidden="true"></i>
		{% translate "GRADES" %}
	</a>
</li>
{% endif %}

<li class="nav-item">
	<a class="nav-link menu-all-results" href="{{ instance|url:'all-results' }}">
		<i class="bi-folder2-open" aria-hidden="true"></i>
		{% translate "ALL_RESULTS" %}
	</a>
</li>

<li class="nav-item">
	<a class="nav-link menu-analytics" href="{{ instance|url:'analytics' }}">
		<i class="bi-bar-chart-fill" aria-hidden="true"></i>
		{% translate "VISUALIZATIONS" %}
	</a>
</li>

<li class="nav-item">
	<a class="nav-link menu-pseudonymize" href="{% url 'toggle-pseudonymization' %}">
		{% if pseudonymize %}
			<i class="bi-eye-fill" aria-hidden="true"></i>
			{% translate "UNPSEUDONYMIZE" %}
		{% else %}
			<i class="bi-eye-slash-fill" aria-hidden="true"></i>
			{% translate "PSEUDONYMIZE" %}
		{% endif %}
	</a>
</li>

{% if is_teacher %}
<li class="nav-item">
	<a class="nav-link menu-edit-news" href="{{ instance|url:'news-list' }}">
		<i class="bi-pencil-square" aria-hidden="true"></i>
		{% translate "EDIT_NEWS" %}
	</a>
</li>
<li class="nav-item menu-edit-course">
	<a class="nav-link menu-course" href="{{ instance|url:'course-edit' }}">
		<i class="bi-gear-fill" aria-hidden="true"></i>
		{% translate "EDIT_COURSE" %}
	</a>
</li>
<li class="nav-item">
	<a class="nav-link menu-deadline-deviations" href="{{ instance|url:'deviations-list-dl' }}">
		<i class="bi-list" aria-hidden="true"></i>
		{% translate "DEADLINE_DEVIATIONS" %}
	</a>
</li>
<li class="nav-item">
	<a class="nav-link menu-submission-deviations" href="{{ instance|url:'deviations-list-submissions' }}">
		<i class="bi-list" aria-hidden="true"></i>
		{% translate "SUBMISSION_DEVIATIONS" %}
	</a>
</li>
<li class="nav-item">
	<a class="nav-link menu-all-submissions" href="{{ instance|url:'all-submissions' }}">
		<span class="bi-list-ul" aria-hidden="true"></span>
		{% translate "ALL_SUBMISSIONS" %}
	</a>
</li>

{% endif %}

{% for group in course_menu.staff_link_groups %}
{% if group.label %}
<li class="header">
	<h4>{{ group.label|parse_localization }}</h4>
</li>
{% endif %}
{% for entry in group.items %}
{% if entry.enabled %}
{% if is_teacher or entry|is_assistant_link %}
<li>
	<a href="{{ entry.url }}" {% if entry.blank %} target="_blank" {% endif %}>
		{% if entry.icon_class %}
		<i class="bi-{{ entry.icon_class }}" aria-hidden="true"></i>
		{% endif %}
		{{ entry.label|parse_localization }}
	</a>
</li>
{% endif %}
{% endif %}
{% endfor %}
{% endfor %}

{% endif %}

{% comment %}
{% if is_student %}
<li class="header">
	<h4>{% trans "ENROLLMENT" %}</h4>
</li>
<li class="menu-unenroll">
	<a data-bs-toggle="modal" data-bs-target="#unenroll-modal" role="button">
		<i class="bi-x-lg-sign" aria-hidden="true"></i>
		{% trans "UNENROLL" %}
	</a>
</li>
{% endif %}
{% endcomment %}
