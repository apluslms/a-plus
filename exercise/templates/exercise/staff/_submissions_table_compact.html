{% load i18n %}
{% load course %}
{% load exercise %}

<table id="submission-table" class="table table-sm">
	<thead>
		<tr>
			<th>{% translate "NUMBER_ABBREVIATED" %}</th>
			<th>{% translate "TIME" %}</th>
			<th>{% translate "STATUS" %}</th>
			<th>{% translate "GRADE" %}</th>
			{% if submissions|length > 1 and files %}
			<th>{% translate "COMPARE" %}</th>
			{% endif %}
		</tr>
	</thead>
	<tbody>
		{% for s in submissions reversed %}
		<tr
			{% if forloop.counter < lowest_visible_index or forloop.counter > highest_visible_index %}
			class="submissions-toggle hidden"
			{% elif forloop.counter == index %}
			class="table-active"
			{% endif %}
		>
			<td>
				{{ forloop.counter }}
			</td>
			<td>
				{% if forloop.counter != index %}
				<a href="{{ s|url:'submission-inspect' }}">
					{{ s.date|date:'DATETIME_SECONDS_FORMAT' }}
				</a>
				{% else %}
				{{ s.date|date:'DATETIME_SECONDS_FORMAT' }}
				{% endif %}
				{% if s.late_penalty_applied %}
				<span class="badge text-bg-warning">
					{% blocktranslate trimmed with percent=s.late_penalty_applied|percent %}
					LATE_W_PENALTY -- {{ percent }}
					{% endblocktranslate %}
				</span>
				{% endif %}
			</td>
			<td>
				{{ s.status|submission_status }}
			</td>
			<td>
				{% if exercise.difficulty %}
					<span class="difficulty">{{ exercise.difficulty }}</span>
				{% endif %}
				<span
					class="badge rounded-pill {% if not s.unofficial %} {% if s.points >= exercise.max_points %}text-bg-success{% elif s.points >= exercise.points_to_pass %}text-bg-warning{% else %}text-bg-danger{% endif %}{% endif %}"
					data-bs-toggle="tooltip"
					data-placement="bottom"
					title="{% if s.unofficial %}{% if s.unofficial_submission_type == 'limit_exceeded' %}{% translate 'LIMIT_EXCEEDED' %}{% elif s.unofficial_submission_type == 'deadline_passed' %}{% translate 'DEADLINE_PASSED' %}{% else %}{% translate 'UNOFFICIAL_DESCRIPTION' %}{% endif %}{% elif s.points >= exercise.points_to_pass %}{% if exercise.points_to_pass > 0 %}{% translate 'PASSED' %}{% endif %}{% else %}{% blocktranslate trimmed with points=exercise.points_to_pass %}POINTS_REQUIRED_TO_PASS -- {{ points }}{% endblocktranslate %}{% endif %}"
				>
					{{ s.points }} / {{ exercise.max_points }}
				</span>

				{% if s == summary.best_submission %}
					{% if s.force_exercise_points %}
					<span
						class="badge text-bg-primary"
						data-bs-toggle="tooltip"
						title="{% translate 'SUBMISSION_FINAL_TOOLTIP' %}"
					>{% translate 'FINAL' %}</span>
					{% else %}
					<span
						class="bi-star"
						data-bs-toggle="tooltip"
						title="{% translate 'SUBMISSION_CHOSEN_TOOLTIP' %}"
					></span>
					{% endif %}
				{% endif %}
				{% if s.is_assessed %}
				<span
					class="badge text-bg-warning"
					data-bs-toggle="tooltip"
					title="{% translate 'SUBMISSION_ASSESSED_TOOLTIP' %}"
				>{% translate 'ASSESSED' %}</span>
				{% endif %}
			</td>
			{% if submissions|length > 1 and files %}
			<td>
				{% if forloop.counter != index %}
				<a class="aplus-button--secondary aplus-button--xs" href="{{ submission|url:'submission-inspect' }}?compare_to={{ s.id }}">
					{% translate "COMPARE" %}
				</a>
				{% endif %}
			</td>
			{% endif %}
		</tr>
		{% endfor %}
		{% if submissions|length > highest_visible_index or lowest_visible_index > 1 %}
		<tr>
			<td colspan="5">
				<button class="aplus-button--secondary aplus-button--xs" data-bs-toggle="visibility" data-bs-target=".submissions-toggle">
					<span class="submissions-toggle">{% translate "SHOW_ALL_SUBMISSIONS" %}</span>
					<span class="submissions-toggle hidden">{% translate "HIDE_OTHER_SUBMISSIONS" %}</span>
				</button>
			</td>
		</tr>
		{% endif %}
	</tbody>
</table>
